
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CellCnn &#8212; CellCnn 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cellcnn">
<h1>CellCnn<a class="headerlink" href="#cellcnn" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>CellCnn is written in Python2.7. There are several ways to run Python, but we recommend using a virtual environment.
To set up a virtual environment, you can perform the following steps:</p>
<ol class="arabic simple">
<li>Download the Python2.7 installation script corresponding to your operating system from <a class="reference external" href="https://conda.io/miniconda.html">https://conda.io/miniconda.html</a> . For example, for Mac OS it should be called “Miniconda2-latest-MacOSX-x86_64.sh”.</li>
<li><dl class="first docutils">
<dt>Run the installation script (please use the script name corresponding to your operating system):</dt>
<dd><code class="docutils literal"><span class="pre">bash</span> <span class="pre">Miniconda2-latest-MacOSX-x86_64.sh</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Open a new terminal and create a virtual environment for CellCnn, e.g. “cellcnn_env”:</dt>
<dd><code class="docutils literal"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">--name</span> <span class="pre">cellcnn_env</span> <span class="pre">python=2.7</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Activate the virtual environment:</dt>
<dd><code class="docutils literal"><span class="pre">source</span> <span class="pre">activate</span> <span class="pre">cellcnn_env</span></code></dd>
</dl>
</li>
</ol>
<hr class="docutils" />
<p>After having Python2.7 running on your system, please do the following to install CellCnn:</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Clone the CellCnn repository:</dt>
<dd><code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/eiriniar/CellCnn.git</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Install the CellCnn dependencies:</dt>
<dd><code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">https://raw.githubusercontent.com/eiriniar/CellCnn/master/requirements.txt</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To install CellCnn, run the following command after replacing <code class="docutils literal"><span class="pre">path_to_CellCnn</span></code> with the actual path in your system:</dt>
<dd><code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">path_to_CellCnn/CellCnn</span></code></dd>
</dl>
</li>
</ol>
<hr class="docutils" />
<p>Note: For the analysis of mass/flow cytometry data, we use the package <code class="docutils literal"><span class="pre">fcm</span> <span class="pre">0.9.1</span></code>.
This package contains a call to a deprecated matplotlib function which raises an exception.
As a workaround, we provide a slightly modified version of <code class="docutils literal"><span class="pre">fcm</span></code> that avoids the deprecated call.
When installing CellCnn, you automatically get our working version of <code class="docutils literal"><span class="pre">fcm</span></code>.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Examples are provided in the subfolder <code class="docutils literal"><span class="pre">CellCnn/cellCnn/examples</span></code>.</p>
<hr class="docutils" />
<p>Alternatively, for the analysis of mass/flow cytometry samples, CellCnn can be run from the command line.
To get a list of command line options please run:</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">run_analysis.py</span> <span class="pre">--help</span></code></p>
<p>For a CellCnn analysis with default settings only two arguments have to be provided:</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">run_analysis.py</span> <span class="pre">-f</span> <span class="pre">fcs_samples_with_labels.csv</span> <span class="pre">-m</span> <span class="pre">markers.csv</span></code></p>
<div class="line-block">
<div class="line">The first input argument is a two-column CSV file, where the first column specifies input sample filenames and the second column the corresponding class labels. An example file is provided in <code class="docutils literal"><span class="pre">CellCnn/cellCnn/examples/NK_fcs_samples_with_labels.csv</span></code>.</div>
<div class="line">The second input argument is a CSV file containing the names of markers/channels that should be used for the analysis. An example file is provided in <code class="docutils literal"><span class="pre">CellCnn/cellCnn/examples/NK_markers.csv</span></code>.</div>
</div>
<p>For example, to perform the analysis outlined in <code class="docutils literal"><span class="pre">CellCnn/cellCnn/examples/NK_cell.ipynb</span></code>
from the command line, you can run the following (assuming your current directory is <code class="docutils literal"><span class="pre">CellCnn/cellCnn/examples</span></code>):</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">../run_analysis.py</span> <span class="pre">-f</span> <span class="pre">NK_fcs_samples_with_labels.csv</span> <span class="pre">-m</span> <span class="pre">NK_markers.csv</span> <span class="pre">-i</span> <span class="pre">NK_cell_dataset/gated_NK/</span> <span class="pre">-o</span> <span class="pre">outdir_NK</span> <span class="pre">--export_csv</span> <span class="pre">--group_a</span> <span class="pre">CMV-</span> <span class="pre">--group_b</span> <span class="pre">CMV+</span> <span class="pre">--verbose</span> <span class="pre">0</span></code></p>
<p>The above command performs a binary classification CellCnn analysis, exports the learned filter weights as CSV files in the directory <code class="docutils literal"><span class="pre">outdir_NK/exported_filter_weights</span></code> and generates result plots in <code class="docutils literal"><span class="pre">outdir_NK/plots</span></code>. The following plots are generated:</p>
<div class="section" id="filter-plots">
<h3>filter_plots<a class="headerlink" href="#filter-plots" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>clustered_filter_weights.pdf :</dt>
<dd>Filter weight vectors from all trained networks that pass a validation accuracy
threshold, grouped in clusters via hierarchical clustering. Each row corresponds to
a filter. The last column(s) indicate the weight(s) connecting each filter to the output
class(es). Indices on the y-axis indicate the filter cluster memberships, as a
result of the hierarchical clustering procedure.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>consensus_filter_weights.pdf :</dt>
<dd>One representative filter per cluster is chosen (the filter with minimum distance to all
other memebers of the cluster). We call these selected filters “consensus filters”.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>best_net_weights.pdf :</dt>
<dd>Filter weight vectors of the network that achieved the highest validation accuracy.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>filter_response_differences.pdf :</dt>
<dd>Difference in cell filter response between classes for each consensus filter.
To compute this difference for a filter, we first choose a filter-specific class, that’s
the class with highest output weight connection to the filter. Then we compute the
average cell filter response (value after the pooling layer) for validation samples
belonging to the filter-specific class (<code class="docutils literal"><span class="pre">v1</span></code>) and the average cell filter response
for validation samples not belonging to the filter-specific class (<code class="docutils literal"><span class="pre">v0</span></code>).
The difference is computed as <code class="docutils literal"><span class="pre">v1</span> <span class="pre">-</span> <span class="pre">v0</span></code>. For regression problems, we cannot compute
a difference between classes. Instead we compute Kendall’s rank correlation coefficient
between the predictions of each individual filter (value after the pooling layer) and
the true response values. This plot helps decide on a cutoff (<code class="docutils literal"><span class="pre">filter_diff_thres</span></code> parameter)
for selecting discriminative filters.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="training-plots">
<h3>training_plots<a class="headerlink" href="#training-plots" title="Permalink to this headline">¶</a></h3>
<p>These plots are generated on the basis of samples used for model training.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>tsne_all_cells.png :</dt>
<dd>Marker distribution overlaid on t-SNE map.</dd>
</dl>
</li>
</ul>
<p>In addition, the following plots are produced for each selected filter (e.g. filter <code class="docutils literal"><span class="pre">i</span></code>):</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>cdf_filter_i.pdf :</dt>
<dd>Cumulative distribution function of cell filter response for filter <code class="docutils literal"><span class="pre">i</span></code>. This plot
helps decide on a cutoff (<code class="docutils literal"><span class="pre">filter_response_thres</span></code> parameter) for selecting the
responding cell population.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>selected_population_distribution_filter_i.pdf :</dt>
<dd>Histograms of univariate marker expression profiles for the cell population selected by
filter <code class="docutils literal"><span class="pre">i</span></code> vs all cells.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>selected_population_frequencies_filter_i.pdf :</dt>
<dd>Boxplot of selected cell population frequencies in samples of the different classes, if running a classification problem.
For regression settings, a scatter plot of selected cell population frequencies vs response variable is generated.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>tsne_cell_response_filter_i.png :</dt>
<dd>Cell filter response overlaid on t-SNE map.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>tsne_selected_cells_filter_i.png :</dt>
<dd>Marker distribution of selected cell population overlaid on t-SNE map.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="validation-plots">
<h3>validation_plots<a class="headerlink" href="#validation-plots" title="Permalink to this headline">¶</a></h3>
<p>Same as the training_plots, but generated on the basis of samples used for model validation.</p>
<hr class="docutils" />
<p>After performing model training once, you can refine the plots with different cutoff values for the selected filters and
cell populations. Training does not have to be repeated for refining the plots. The pre-computed results can be used with the option <code class="docutils literal"><span class="pre">--load_results</span></code>.</p>
<p>Another relevant argument is <code class="docutils literal"><span class="pre">--export_selected_cells</span></code>, which produces a CSV result file for each input FCS file and stores it in <code class="docutils literal"><span class="pre">outdir/selected_cells</span></code>. Rows in the CSV result file correspond to cells in the order found in the FCS input file.
The CSV result file contains two columns per selected filter, the first indicating the cell filter response as a continuous value and the second containing a binary value resulting from thresholding the continuous cell filter response. This later column is an indicator of whether a cell belongs to the cell population selected by a particular filter.</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">../run_analysis.py</span> <span class="pre">-f</span> <span class="pre">NK_fcs_samples_with_labels.csv</span> <span class="pre">-m</span> <span class="pre">NK_markers.csv</span> <span class="pre">-i</span> <span class="pre">NK_cell_dataset/gated_NK/</span> <span class="pre">-o</span> <span class="pre">outdir_NK</span> <span class="pre">--group_a</span> <span class="pre">CMV-</span> <span class="pre">--group_b</span> <span class="pre">CMV+</span> <span class="pre">--filter_response_thres</span> <span class="pre">0.3</span> <span class="pre">--load_results</span> <span class="pre">--export_selected_cells</span></code></p>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>For additional information, CellCnn’s documentation is hosted on <a class="reference external" href="http://eiriniar.github.io/CellCnn/">http://eiriniar.github.io/CellCnn/</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CellCnn</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#filter-plots">filter_plots</a></li>
<li><a class="reference internal" href="#training-plots">training_plots</a></li>
<li><a class="reference internal" href="#validation-plots">validation_plots</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/includeme.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Eirini Arvaniti.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/includeme.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>